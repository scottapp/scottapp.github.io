(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{130:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,c=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=p(n),d=a,m=b["".concat(i,".").concat(d)]||b[d]||u[d]||c;return n?r.a.createElement(m,o(o({ref:t},l),{},{components:n})):r.a.createElement(m,o({ref:t},l))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var c=n.length,i=new Array(c);i[0]=d;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:a,i[1]=o;for(var l=2;l<c;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},220:function(e,t,n){"use strict";n.r(t),t.default="data:image/png;base64,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"},221:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_2-5fb14b8b711af4f2e3789e876cc27700.png"},222:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_4-4d8e5f6ea98b6d468fc52fd58ab3b5c5.png"},223:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_6-29c48a382ec791db783f69a3ef63b0f2.png"},224:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_8-810b89c8891d15656199f5f8daa6fb62.png"},225:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_10-d4f85c3d5362ff3b6597ebccf5ee28e5.png"},226:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_12-98fdb8bda701fa15d34a322dc9b2b4ba.png"},227:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_14-94f1fc9f2d8b6798c8993336468eadbc.png"},228:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_16-f71a0c6e43e0e68c3b68cd80e2a8534d.png"},229:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_18-748b1783792302c83cb238e722d3f83d.png"},230:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_20-bf30d066e9db29230b509e9c773f3ee1.png"},231:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_22-22db9bf3dfb8adc5881e05cb2b7a3a3b.png"},232:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/401_CNN_11_24-a3559152455a6ab1b5b3456df159b8b5.png"},97:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return o})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return p}));var a=n(3),r=n(7),c=(n(0),n(130)),i={title:"401 CNN"},o={unversionedId:"ai/Docker-PyTorch-Tutorial/401_CNN",id:"ai/Docker-PyTorch-Tutorial/401_CNN",isDocsHomePage:!1,title:"401 CNN",description:"View more, visit my tutorial page//mofanpy.com/tutorials/",source:"@site/docs/ai/Docker-PyTorch-Tutorial/401_CNN.md",slug:"/ai/Docker-PyTorch-Tutorial/401_CNN",permalink:"/docs/ai/Docker-PyTorch-Tutorial/401_CNN",version:"current",sidebar:"AI",previous:{title:"206 Optimizers",permalink:"/docs/ai/Docker-PyTorch-Tutorial/306_optimizer"},next:{title:"402 RNN",permalink:"/docs/ai/Docker-PyTorch-Tutorial/402_RNN"}},s=[],l={toc:s};function p(e){var t=e.components,i=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(a.a)({},l,i,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"View more, visit my tutorial page: ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://mofanpy.com/tutorials/"}),"https://mofanpy.com/tutorials/"),"\nMy Youtube Channel: ",Object(c.b)("a",Object(a.a)({parentName:"p"},{href:"https://www.youtube.com/user/MorvanZhou"}),"https://www.youtube.com/user/MorvanZhou")),Object(c.b)("p",null,"Dependencies:"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"torch: 0.1.11"),Object(c.b)("li",{parentName:"ul"},"torchvision"),Object(c.b)("li",{parentName:"ul"},"matplotlib")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"import torch\nimport torch.nn as nn\nfrom torch.autograd import Variable\nimport torch.utils.data as Data\nimport torchvision\nimport matplotlib.pyplot as plt\n%matplotlib inline\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"torch.manual_seed(1)    # reproducible\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"<torch._C.Generator at 0x7f33c006fe50>\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# Hyper Parameters\nEPOCH = 1               # train the training data n times, to save time, we just train 1 epoch\nBATCH_SIZE = 50\nLR = 0.001              # learning rate\nDOWNLOAD_MNIST = True   # set to False if you have downloaded\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# Mnist digits dataset\ntrain_data = torchvision.datasets.MNIST(\n    root='./mnist/',\n    train=True,                                     # this is training data\n    transform=torchvision.transforms.ToTensor(),    # Converts a PIL.Image or numpy.ndarray to\n                                                    # torch.FloatTensor of shape (C x H x W) and normalize in the range [0.0, 1.0]\n    download=DOWNLOAD_MNIST,                        # download it if you don't have it\n)\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz\nDownloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz\nDownloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz\nDownloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz\nProcessing...\nDone!\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# plot one example\nprint(train_data.train_data.size())                 # (60000, 28, 28)\nprint(train_data.train_labels.size())               # (60000)\nplt.imshow(train_data.train_data[0].numpy(), cmap='gray')\nplt.title('%i' % train_data.train_labels[0])\nplt.show()\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"torch.Size([60000, 28, 28])\ntorch.Size([60000])\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(220).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# Data Loader for easy mini-batch return in training, the image batch shape will be (50, 1, 28, 28)\ntrain_loader = Data.DataLoader(dataset=train_data, batch_size=BATCH_SIZE, shuffle=True)\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# convert test data into Variable, pick 2000 samples to speed up testing\ntest_data = torchvision.datasets.MNIST(root='./mnist/', train=False)\ntest_x = Variable(torch.unsqueeze(test_data.test_data, dim=1)).type(torch.FloatTensor)[:2000]/255.   # shape from (2000, 28, 28) to (2000, 1, 28, 28), value in range(0,1)\ntest_y = test_data.test_labels[:2000]\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"class CNN(nn.Module):\n    def __init__(self):\n        super(CNN, self).__init__()\n        self.conv1 = nn.Sequential(         # input shape (1, 28, 28)\n            nn.Conv2d(\n                in_channels=1,              # input height\n                out_channels=16,            # n_filters\n                kernel_size=5,              # filter size\n                stride=1,                   # filter movement/step\n                padding=2,                  # if want same width and length of this image after con2d, padding=(kernel_size-1)/2 if stride=1\n            ),                              # output shape (16, 28, 28)\n            nn.ReLU(),                      # activation\n            nn.MaxPool2d(kernel_size=2),    # choose max value in 2x2 area, output shape (16, 14, 14)\n        )\n        self.conv2 = nn.Sequential(         # input shape (1, 28, 28)\n            nn.Conv2d(16, 32, 5, 1, 2),     # output shape (32, 14, 14)\n            nn.ReLU(),                      # activation\n            nn.MaxPool2d(2),                # output shape (32, 7, 7)\n        )\n        self.out = nn.Linear(32 * 7 * 7, 10)   # fully connected layer, output 10 classes\n\n    def forward(self, x):\n        x = self.conv1(x)\n        x = self.conv2(x)\n        x = x.view(x.size(0), -1)           # flatten the output of conv2 to (batch_size, 32 * 7 * 7)\n        output = self.out(x)\n        return output, x    # return x for visualization\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"cnn = CNN()\nprint(cnn)  # net architecture\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"CNN(\n  (conv1): Sequential(\n    (0): Conv2d(1, 16, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))\n    (1): ReLU()\n    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n  )\n  (conv2): Sequential(\n    (0): Conv2d(16, 32, kernel_size=(5, 5), stride=(1, 1), padding=(2, 2))\n    (1): ReLU()\n    (2): MaxPool2d(kernel_size=2, stride=2, padding=0, dilation=1, ceil_mode=False)\n  )\n  (out): Linear(in_features=1568, out_features=10, bias=True)\n)\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"optimizer = torch.optim.Adam(cnn.parameters(), lr=LR)   # optimize all cnn parameters\nloss_func = nn.CrossEntropyLoss()                       # the target label is not one-hotted\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# following function (plot_with_labels) is for visualization, can be ignored if not interested\nfrom matplotlib import cm\ntry: from sklearn.manifold import TSNE; HAS_SK = True\nexcept: HAS_SK = False; print('Please install sklearn for layer visualization')\ndef plot_with_labels(lowDWeights, labels):\n    plt.cla()\n    X, Y = lowDWeights[:, 0], lowDWeights[:, 1]\n    for x, y, s in zip(X, Y, labels):\n        c = cm.rainbow(int(255 * s / 9)); plt.text(x, y, s, backgroundcolor=c, fontsize=9)\n    plt.xlim(X.min(), X.max()); plt.ylim(Y.min(), Y.max()); plt.title('Visualize last layer'); plt.show(); plt.pause(0.01)\n\nplt.ion()\n# training and testing\nfor epoch in range(EPOCH):\n    for step, (x, y) in enumerate(train_loader):   # gives batch data, normalize x when iterate train_loader\n        b_x = Variable(x)   # batch x\n        b_y = Variable(y)   # batch y\n\n        output = cnn(b_x)[0]               # cnn output\n        loss = loss_func(output, b_y)   # cross entropy loss\n        optimizer.zero_grad()           # clear gradients for this training step\n        loss.backward()                 # backpropagation, compute gradients\n        optimizer.step()                # apply gradients\n\n        if step % 100 == 0:\n            test_output, last_layer = cnn(test_x)\n            pred_y = torch.max(test_output, 1)[1].data.squeeze()\n            accuracy = (pred_y == test_y).sum().item() / float(test_y.size(0))\n            print('Epoch: ', epoch, '| train loss: %.4f' % loss.data[0], '| test accuracy: %.2f' % accuracy)\n            if HAS_SK:\n                # Visualization of trained flatten layer (T-SNE)\n                tsne = TSNE(perplexity=30, n_components=2, init='pca', n_iter=5000)\n                plot_only = 500\n                low_dim_embs = tsne.fit_transform(last_layer.data.numpy()[:plot_only, :])\n                labels = test_y.numpy()[:plot_only]\n                plot_with_labels(low_dim_embs, labels)\nplt.ioff()\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"/home/yoshitaka-i/.conda/envs/tensor/lib/python3.5/site-packages/ipykernel_launcher.py:29: UserWarning: invalid index of a 0-dim tensor. This will be an error in PyTorch 0.5. Use tensor.item() to convert a 0-dim tensor to a Python number\n\n\nEpoch:  0 | train loss: 2.3101 | test accuracy: 0.20\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(221).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.6699 | test accuracy: 0.88\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(222).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0701 | test accuracy: 0.94\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(223).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.1329 | test accuracy: 0.94\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(224).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0395 | test accuracy: 0.96\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(225).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0199 | test accuracy: 0.96\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(226).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.1077 | test accuracy: 0.97\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(227).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0391 | test accuracy: 0.97\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(228).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0789 | test accuracy: 0.97\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(229).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.1067 | test accuracy: 0.97\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(230).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0277 | test accuracy: 0.97\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(231).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"Epoch:  0 | train loss: 0.0251 | test accuracy: 0.98\n")),Object(c.b)("p",null,Object(c.b)("img",{alt:"png",src:n(232).default})),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{className:"language-python"}),"# print 10 predictions from test data\ntest_output, _ = cnn(test_x[:10])\npred_y = torch.max(test_output, 1)[1].data.numpy().squeeze()\nprint(pred_y, 'prediction number')\nprint(test_y[:10].numpy(), 'real number')\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(a.a)({parentName:"pre"},{}),"[7 2 1 0 4 1 4 9 5 9] prediction number\n[7 2 1 0 4 1 4 9 5 9] real number\n")))}p.isMDXComponent=!0}}]);